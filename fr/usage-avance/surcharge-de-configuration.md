---
title: Surcharge de configuration
description: >-
  Description des surcharges locales de configurations appliqu√©es √† des jeux en
  particulier ou a des repertoires complets.
---

# Surcharge de configuration


>**Recalbox 7.0 et sup√©rieur!**
{.is-warning}

## Aper√ßu des possibilit√©s

A partir de Recalbox 7.0, vous pouvez surcharger les configuration d'un jeu ou d'un r√©pertoire complet.

√áa signifie qu'en ajoutant des fichiers particuliers dans vos r√©pertoires de roms, vous allez pouvoir modifier le comportement de Recalbox, de Retroarch ou de l'√©mulateur pour un jeu particulier ou pour tous les jeux d'un r√©pertoire.

Concr√®tement, vous allez pouvoir agir sur:

* La configuration de Recalbox
* La configuration g√©n√©rale de Retroarch
* La configuration des cores Retroarch

Accessoirement, vous aurez √©galement la possibilit√© de surcharger les images et les descriptions des r√©pertoires de roms tels qu'ils sont affich√©s dans EmulationStation, nous verrons pourquoi un peu plus loin.

P√™le-m√™le, on va pouvoir, pour un jeu ou un ensemble de jeux:

* D√©finir un √©mulateur ou un core particulier
* D√©finir une r√©solution vid√©o particuli√®re
* Modifier la configuration vid√©o de Retroarch
* Modifier les options des cores
* etc.

## G√©n√©ralit√©s

Les surcharges vont s'appliquer sur un fichier de base. Ces fichiers sont les fichiers qui sont charg√©s en tout premier lieu par le lanceur python \(appel√© **configgen**\) lorsqu'on lance un jeu:

| Cible | Fichier de configuration |
| :--- | :--- |
| **Recalbox** | `/recalbox/share/system/recalbox.conf` |
| **Retroarch** | `/recalbox/share/system/configs/retroarch/retroarchcustom.cfg.origin` |
| **Cores** | `/recalbox/share/system/configs/retroarch/cores/retroarch-core-options.cfg` |

Tous les fichiers de configuration que l'on peut surcharger sont des fichiers de type clefs/valeurs.  
On va donc pouvoir modifier la valeur d'une clefs de la configuration de base, ou d√©finir une clef inexistante.

Nous pourrons m√™me surcharger les surcharges! En effet le syst√®me permet de d√©finir une surcharge par niveau de r√©pertoires.  
  
Il va donc commencer par charger la configuration de base, puis appliquer successivement tous les fichiers de surcharge qu'il trouvera dans les r√©pertoires, en commen√ßant √† la racine. Puis au final, il tentera d'appliquer la surcharge du jeu, si elle existe.



Prenons un exemple, si on lance le jeu `/recalbox/share/roms/snes/platform/Aladdin (France).zip`, le **configgen** cherchera √† surcharger la configuration retroarch, en chargeant dans l'ordre:

1. `Base: /recalbox/share/system/configs/retroarch/retroarchcustom.cfg`
2. `Path: /.retroarch.cfg`
3. `Path: /recalbox/.retroarch.cfg`
4. `Path: /recalbox/share/.retroarch.cfg`
5. `Path: /recalbox/share/roms/.retroarch.cfg`
6. `Path: /recalbox/share/roms/snes/.retroarch.cfg`
7. `Path: /recalbox/share/roms/snes/platform/.retroarch.cfg`
8.    `File: /recalbox/share/roms/snes/platform/Aladdin (France).zip.retroarch.cfg`

Bien entendu, il n'est pas vraiment conseill√© de surcharger les configuration avant d'atteindre au minimum le r√©pertoire d'un syst√®me.

Vous remarquerez que pour surcharger un r√©pertoire, les fichiers de surcharge doivent se trouver **√† l‚Äôint√©rieur** du r√©pertoire, et commencer par un point \(.\), ce qui les rend invisible pour le syst√®me linux.  
  
A contrario, la surcharge d'un jeu, doit √™tre nomm√© exactement comme le jeu, **extension de fichier comprise**, suivit du suffixe de surcharge, `.retroarch.cfg` dans l'exemple au dessus


>√âtant donn√© que les fichiers de surcharges se trouvent √† l‚Äôint√©rieur de vos r√©pertoires de roms, ils ne craignent pas un plantage de Recalbox, une mise √† jour qui se serait mal pass√©, ou un crash de votre SD \(√† condition d'utiliser un support externe bien entendu
>
>Ils sont en outre transportables : Prenez votre clef USB avec vous pour jouer chez un ami, votre configuration s'appliquera sans rien devoir toucher !
{.is-info}

## Surcharger Recalbox

Surcharger la configuration Recalbox pr√©sente deux int√©r√™ts imm√©diats :

* Pouvoir s√©lectionner un mode vid√©o particulier pour un jeu ou un ensemble de jeux. Les aficionados du pixel perfect en arcade seront ravis.
* Pouvoir choisir un core ou un √©mulateur standalone pour un jeu ou un ensemble de jeux.

Il existe d'autres possibilit√©, et nul doute que vous en trouverez üòâ 


>Surcharger des clefs qui ne sont pas utilis√©es par le **configgen** n'a aucun effet ! N‚Äôesp√©rez pas modifier le comportement d'EmulationStation \(en surchargeant les tris par exemple\).
{.is-danger}


>Rappel:  
>Surcharge r√©pertoire: **`/path/to/your/roms/.recalbox.conf`**  
>Surcharge rom: **`/path/to/your/roms/file.zip.recalbox.conf`**
{.is-warning}



### Exemple 1: Multiple versions de MAME

Pourquoi se contenter d'une seule version de MAME alors que nous pourrions toutes les avoir.

Par exemple, vous pourriez avoir MAME 2003 Plus et MAME 2010, chaque romset dans son propre r√©pertoire:  
  
`/recalbox/share/roms/mame/  
 ‚îú‚îÄ‚îÄ MAME2003Plus  
 ‚îî‚îÄ‚îÄ MAME2010`



Il suffit alors d'ajouter le fichier :

{% code title="/recalbox/share/roms/mame/MAME2003Plus/.recalbox.conf" %}
```text
mame.emulator=libretro
mame.core=mame2003_plus
```
{% endcode %}



Et le fichier :

{% code title="/recalbox/share/roms/mame/MAME2010/.recalbox.conf" %}
```text
mame.emulator=libretro
mame.core=mame2010
```
{% endcode %}


>Et voil√†! C'est tout. D√©sormais, tous les jeux du r√©pertoire MAME2003Plus se lanceront avec le core mame2003\_plus-libretro, et ceux du repertoire MAME2010 avec le core mame2010-libretro!
{.is-success}



### Exemple 2: Affecter un core particulier √† un jeu

Mon jeu `/recalbox/share/pcengine/1943 Kai (Japan).zip` fonctionne mieux avec le core `mednafen_pce_fast_libretro` qu'avec le core `mednafen_supergrafx_libretro` par d√©faut \(hypoth√®se totalement arbitraire pour l'exemple\).

Jusqu'√† pr√©sent, il √©tait possible de le faire via EmulationStation, en √©ditant les metadata du jeu. L'information est alors stock√©e dans le fichier `gamelist.xml`. Une erreur d'√©criture du fichier, un scrappe malencontreux, et c'est toute la configuration qui est perdue.

Ici il suffit d'ajouter le fichier:

{% code title="/recalbox/share/roms/pcengine/1943Kai\(Japan\).zip.recalbox.conf" %}
```text
global.emulator=libretro
global.core=mednafen_pce_fast
```
{% endcode %}


>Cette fois, pas de risque de perte de la configuration !  
>Bien entendu, √©diter les metadata via EmulationStation fonctionne toujours. En revanche, un fichier de surcharge sera prioritaire sur ce qui est stock√© dans le `gamelist.xml`.
{.is-success}



### Exemple 3: Modifier le mode vid√©o pour un jeu

Sur mon Raspberry Pi2, le mode vid√©o par d√©faut est CEA 4 HDMI. Mais sur le jeu **`Blazing Stars`** sur **FinalBurn Neo**, tourne un peu lentement. Le passer en 240p aiderait certainement, en plus d'√™tre pixel-perfect ! \(encore une fois, hypoth√®se tout √† fait hypoth√©tique, juste pour l'exemple\)

{% code title="/recalbox/share/roms/fba\_libretro/blazstar.zip.recalbox.conf" %}
```text
global.videomode=CEA 8 HDMI
```
{% endcode %}


>Et voil√† ! Lorsque je lance ce jeux l√†, ma TV commute en 240p, et je peux pleinement profiter de Blazing Stars.
{.is-success}

## Surcharger Retroarch

Les configurations Retroarch concernent Retroarch lui m√™me \(et les options de configurations sont tr√®s nombreuses !\) ainsi que les diff√©rents cores, qui ont chacun des options particuli√®res en fonction des machines qu'ils √©mulent.


>Il existe d√©j√† des m√©canismes propres √† Recalbox et √† Retroarch pour surcharger soit la ligne de commande qui lance l‚Äô√©mulateur \(via Recalbox.conf\), soit directement les configurations Retroarch/Cores \(via les menus de Retroarch\)
>
>Mais aucun de ces syst√®mes ne permettait d'appliquer les surcharges √† des r√©pertoires entiers et/ou de conserver ces configurations sp√©cifiques au m√™me endroit que les roms. Ce qui est particuli√®rement int√©ressant pour les gens qui utilisent des partages r√©seaux pour alimenter en roms plusieurs Recalbox !
{.is-info}



### Configuration de Retroarch

La configuration Retroarch elle m√™me est extr√™mement riche, et couvre √©norm√©ment de domaines diff√©rents.

Il est inutile de s‚Äô√©tendre sur la question, le mieux est d'aller voir directement dans le fichier de RetroArch, qui est particuli√®rement bien document√© : [https://github.com/libretro/RetroArch/blob/master/retroarch.cfg](https://github.com/libretro/RetroArch/blob/master/retroarch.cfg)

Les possibilit√©s offertes par les surcharges locales sont √©normes, parmi lesquelles on peut compter :

* Configuration vid√©o : Ratio, √âchelle, Anti-alias, rotation d'√©cran, ou m√™me s√©lections de shaders, etc.
* Tuning de l'audio pour certains jeux difficiles
* Overlays
* Certaines options concernant les inputs : s√©lection souris, sensibilit√©, etc.
* Forcer des configurations NetPlay particuli√®res
* Changer les r√©pertoires Retroarch \(sauvegarde par exemple\)
* R√©gler divers options : Rembobinage, Avance rapide, etc.
* ...

A l'instar des surcharges de configuration Recalbox, on va pouvoir cr√©er des fichiers `.retroarch.cfg` pour les r√©pertoires et pour les roms.


>**Rappel :**  
>Surcharge r√©pertoire: **`/path/to/your/roms/.retroarch.cfg`**  
>Surcharge rom: **`/path/to/your/roms/file.zip.retroarch.cfg`**
{.is-warning}

#### Exemple 1: Forcer une configuration vid√©o

#### Exemple 2: Forcer une shader pour un r√©pertoire complet



### Configuration des Cores

Surcharger les options des cores offre d'√©normes possibilit√©s, _**parmi lesquelles une fonctionnalit√© tr√®s attendues des fans "d'ordinausaures": La possibilit√© de d√©finir un r√©pertoire par sous syst√®me !**_


>Les surcharges de cores sont ajout√©es au fichier _share/system/configs/retroarch/cores/retroarch-core-options.cfg_ au lancement du jeu concern√©, cela implique que, une fois le jeu ferm√©, **elles seront sauvegard√©es dans ce m√™me fichier**, pour √©viter toute mauvaise surprise, nous recommandons de surcharger les cl√©s dans le dossier avec des valeurs par d√©faut \(par exemple `fbneo-frameskip = "0"`\) si vous tenez √† surcharger un jeu en particulier avec des valeurs sp√©cifiques \(par exemple `fbneo-frameskip = "2"`\), ainsi vous conserverez vos valeurs "de base" pour les fichiers n'ayant pas de surcharges personnalis√©es.
{.is-danger}

C'est particuli√®rement int√©ressants pour les cores multi-machines, comme:

* **theodore**, qui couvre les Thomson MO5, MO6 et TO7 jusqu'au TO9+ 
* **atari800**, qui couvre tous les Atari 8bits, de la premi√®re serie 800, jusqu'aux XE, en passant par les XL. 
* **vice**, qui √©mule maintenant le C64, le PET, le Vic20, le CBM2, ... 
* **hatari**, qui √©mule du premier 520ST aux derniers Falcons 
* et d'autres encore...


>**Rappel :**  
>Surcharge r√©pertoire: **`/path/to/your/roms/.core.cfg`**  
>Surcharge rom: **`/path/to/your/roms/file.zip.core.cfg`**
{.is-warning}



#### Exemple 1: Configurer des sous-syst√®mes Thomson

Les Thomson, ordinateurs fran√ßais 8bits des ann√©es 80, se sont scind√©s en 2 s√©ries : 

* Les MO, qui ont donn√© le premier MO5, puis plus tard le MO6 avec son clavier m√©canique et son lecteur de cassette int√©gr√© 
* Les TO, qui ont donn√© les premiers TO7 et TO7-70, puis plus tard les TO8 et TO8D, avec lecteurs de disquettes, et la s√©rie des TO9 et TO9+, ordinateurs aux looks plus professionnels

Les jeux MO et TO ne sont pas du tout compatibles. Au sein d'une m√™me s√©rie, il y a compatibilit√© ascendante : Un MO6 fera tourner \(en g√©n√©ral\) les jeux du MO5.  
  
Bien entendu, on cherchera √† √©muler chaque jeu avec la machine la plus proche de la machine pour laquelle il a √©t√© con√ßu √† l'origine, afin d‚Äô√©viter tout probl√®me et maximiser les chance d'avoir une √©mulation parfaite.

Si l'on prend les packs TOSEC \([http://www.tosec.org](https://www.tosecdev.org/)\), les jeux Thomson on √©t√© r√©partis en 4 sous-syst√®mes :

* MO5
* MO6
* TO7 \(TO7-70\)
* TO8, TO8D, TO9 et TO9+

Nous allons donc cr√©er une arborescence similaire:

`recalbox/share/roms/thomson/  
 ‚îú‚îÄ‚îÄ MO5  
 ‚îú‚îÄ‚îÄ MO6  
 ‚îú‚îÄ‚îÄ TO7  
 ‚îî‚îÄ‚îÄ TO8,TO8D,TO9,TO9+`

Dans la racine du syst√®me, nous allons placer un fichier de surcharge core, pour forcer quelques options int√©ressantes pour tout le monde :

{% code title="/recalbox/share/roms/thomson/.core.cfg" %}
```text
theodore_rom = "Auto"
theodore_autorun = "enabled"
theodore_floppy_write_protect = "enabled"
theodore_tape_write_protect = "enabled"
```
{% endcode %}

Si on rajoute des jeux dans la racine, ou dans un autre r√©pertoire, on indique √† l‚Äô√©mulateur d'essayer de d√©tecter la meilleure machine \(en se basant sur le nom du fichier\).  
  
On prot√®ge aussi les fichiers roms par d√©faut, et on enclenche la m√©canique d'autorun bien pratique quand on ne connait pas trop les machines d'origine.

Ensuite dans chaque sous-r√©pertoire, on va ajouter une surcharge sur le clef `theodore_rom` qui d√©termine la machine.

{% code title="/recalbox/share/roms/thomson/MO5/.core.cfg" %}
```text
theodore_rom = "MO5"
```
{% endcode %}

{% code title="/recalbox/share/thomson/MO6/.core.cfg" %}
```text
theodore_rom = "MO6"
```
{% endcode %}

{% code title="/recalbox/share/thomson/TO7/.core.cfg" %}
```text
theodore_rom = "TO7"
```
{% endcode %}

{% code title="/recalbox/share/thomson/TO8,TO8D,TO9,TO9+.core.cfg" %}
```text
theodore_rom = "TO9+"
```
{% endcode %}

Pour la derni√®re s√©rie, la machine la plus puissante a √©t√© s√©lectionn√©e : le TO9+


>C'est termin√©! Vous avez maintenant 4 sous syst√®mes Thomson. L‚Äô√©mulateur n'est plus en automatique et le risque de le voir choisir le mauvais syst√®me ou un syst√®me par d√©faut dispara√Æt.
>
>Bien entendu, le core Theodore peut parfois "auto-d√©tecter" la machine, mais ce n'est pas le cas avec d'autres cores qui ont besoin d'avoir le bon sous-syst√®me au lancement.
{.is-success}

## Surcharger l'aspect des r√©pertoires

Pour parfaire les possibilit√©s offertes par la d√©finitions de sous-syst√®mes, que ce soit en surchargeant la configuration Recalbox pour **MAME** par exemple, ou en surchargeant le core **Th√©odore** pour pleinement profiter des machines TO et MO de l'√©poque, nous avons ajout√© le possibilit√© de surcharger l'image et la description d'un r√©pertoire.

Ceci permet par exemple, d'avoir sur un r√©pertoire, la photo et la description de la machine dont les roms se trouvent dans le-dit repertoire.

Il suffit pour √ßa d'ajouter au minimum, un fichier image au format **PNG**, et nomm√© `.folder.picture.png` dans le r√©pertoire dont on veut surcharger l'image dans EmulationStation  
La r√©solution importe peu, mais gardez √† l'esprit qu'une resolution identique ou approchante √† vos images de _scrappe_ reste recommand√©e.

Optionnellement, vous pouvez ajouter une description texte, qui se glissera sous l'image, exactement comme pour les jeux _scrapp√©s_.  
Le fichier doit √™tre un fichier texte simple, nomm√© `.folder.description.txt`


>**Rappel :**  
>Surcharge image: **`/path/to/your/folder/.folder.picture.png`**  
>Surcharge description: **`/path/to/your/roms/.folder.description.txt`**
{.is-warning}



### Exemple 1: du MO5 au TO9

Reprenons le r√©pertoire **thomson** utilis√© plus haut, que nous avions d√©coup√© en 4 sous-syst√®mes comme l'a fait **TOSEC**.

`/recalbox/share/roms/thomson/  
 ‚îú‚îÄ‚îÄ .core.cfg  
 ‚îú‚îÄ‚îÄ gamelist.xml  
 ‚îú‚îÄ‚îÄ media  
 ‚îÇ ‚îú‚îÄ‚îÄ box3d  
 ‚îÇ ‚îú‚îÄ‚îÄ images  
 ‚îÇ ‚îî‚îÄ‚îÄ videos  
 ‚îú‚îÄ‚îÄ MO5  
 ‚îÇ ‚îú‚îÄ‚îÄ .core.cfg  
 ‚îÇ ‚îú‚îÄ‚îÄ .folder.description.txt  
 ‚îÇ ‚îú‚îÄ‚îÄ .folder.picture.png  
 ‚îÇ ‚îú‚îÄ‚îÄ [FD]  
 ‚îÇ ‚îú‚îÄ‚îÄ [K7]  
 ‚îÇ ‚îú‚îÄ‚îÄ [M5]  
 ‚îÇ ‚îú‚îÄ‚îÄ [QD]  
 ‚îÇ ‚îú‚îÄ‚îÄ [SAP]  
 ‚îÇ ‚îî‚îÄ‚îÄ [WAV]  
 ‚îú‚îÄ‚îÄ MO6  
 ‚îÇ ‚îú‚îÄ‚îÄ .core.cfg  
 ‚îÇ ‚îú‚îÄ‚îÄ .folder.picture.png  
 ‚îÇ ‚îú‚îÄ‚îÄ .folder.description.txt  
 ‚îÇ ‚îî‚îÄ‚îÄ [K7]  
 ‚îú‚îÄ‚îÄ TO7  
 ‚îÇ ‚îú‚îÄ‚îÄ .core.cfg  
 ‚îÇ ‚îú‚îÄ‚îÄ .folder.picture.png  
 ‚îÇ ‚îú‚îÄ‚îÄ .folder.description.txt  
 ‚îÇ ‚îú‚îÄ‚îÄ [K7]  
 ‚îÇ ‚îî‚îÄ‚îÄ [M7]  
 ‚îî‚îÄ‚îÄ TO8, TO8D, TO9, TO9+  
   ‚îú‚îÄ‚îÄ .core.cfg  
   ‚îú‚îÄ‚îÄ .folder.picture.png  
   ‚îú‚îÄ‚îÄ .folder.description.txt  
   ‚îú‚îÄ‚îÄ [FD]  
   ‚îú‚îÄ‚îÄ [K7]  
   ‚îú‚îÄ‚îÄ [QD]  
   ‚îî‚îÄ‚îÄ [SAP]`



Le fichier `.folder.picture.png` du r√©pertoire /recalbox/share/roms/thomson contient une image de la machine:

![Photo MO5](/migration-images/usage-avance/surcharge-de-configuration/.folder.picture.png)



Et le fichier `.folder.description.txt` contient:

{% code title="/recalbox/share/roms/thomson/MO5/.folder.description.txt" %}
```text
Brand:
    - Thomson (France)
CPU:
    - Motorola 6809E running at 1 MHz
RAM:
    - 48Kb (extensible)
ROM:
    - 16Kb
Graphics:
    - Text mode : 40 columns x 25 lines
    - Graphic mode: 320 x 200, 16 colors (proximity constraint)
Sound:
    - 1bit generator (6bit DAC module extention possible)
Input devices:
    - 57 keys integrated keyboard
    - Optical pen
    - Joysticks
Interfaces:
    - External power supply
    - DIN Connector (optical pen)
    - DIN Connector (tape drive)
    - Peritel (RGB)
    - Extension port
Software:
    - BASIC 1.0 Integrated
Standard devices:
    - Cartridge port (M√©mo5)
    - External tape drive (MO5 specific model)
    - External disk drive
Dimensions:
    - 51 x 291 x 190 mm 
Weight:
    - 1.1 kg
Released:
    - 1984
    
```
{% endcode %}



Et voil√† le r√©sultat dans EmulationStation:

![EmulationStation](/migration-images/usage-avance/surcharge-de-configuration/capture-du-2019-09-07-11-52-59.png)



### Exemple 2: MAME

De la m√™me fa√ßon, sur le premier exemple qui montre comment avoir plusieurs versions de **MAME** dans le r√©pertoire MAME, nous pourrions imaginer avoir un joli logo MAME 2003 Plus et MAME 2010, suivit d'un petit texte qui donne le nombre de jeu, et la version du romset de MAME correspondante.



Un petit logo:

![/recalbox/share/roms/mame/MAME2003Plus/.folder.description.txt](/migration-images/usage-avance/surcharge-de-configuration/.folder.picture%20%281%29.png)



Un petit texte :

{% code title="/recalbox/share/roms/mame/MAME2003Plus/.folder.description.txt" %}
```text
MAME 2003 Plus est une version am√©lior√©e de MAME2003, avec √©normement de correction de bug et des centaines de nouveaux jeux.

RomSet Special bas√© sur le romset MAME 0.78

4859 jeux au total!
```
{% endcode %}



Et voila le r√©sultat :

![](/migration-images/usage-avance/surcharge-de-configuration/sans-titre%20%281%29.png)

## Emulateurs "Standalone"

Actuellement, nous ne pouvons pas surcharger les configuration des √©mulateurs standalone, hormis partiellement celles **d'Amiberry**, l‚Äô√©mulateur Amiga pour ARM.

Il n'est pas pr√©vu d'ajouter ces surcharges, car elles demandent du code et des tests particuliers. Ce n'est en outre pas forcement faisable pour tous les √©mulateurs, mais dans tous les cas, √ßa demandera un travail plus ou moins long.

Cependant, en fonction des demandes et de leur pertinence, nous pourrons √©ventuellement voir au cas par cas.

